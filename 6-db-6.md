### Задача 1
* напишите список операций, которые вы будете производить для остановки запроса пользователя;
```commandline
#получаем список забросов, выполняющиеся более 3х минут
db.currentOp({"secs_running":{$gte: 180}})
#завершаем нужный запрос
db.killOp(opid)
```
* предложите вариант решения проблемы с долгими (зависающими) запросами в MongoDB.
  * Посторить индекс
  * построить план запроса
  * с помощью Database Profiler
<hr>

### Задача 2
При масштабировании сервиса до N реплик вы увидели, что:
* сначала происходит рост отношения записанных значений к истекшим,
* Redis блокирует операции записи.
Как вы думаете, в чём может быть проблема?


### Ответ:

Redis удаляет ключи с истекшим сроком действия двумя способами:

* <i>ленивый </i>способ истекает сроком действия ключа, когда он запрашивается командой, но оказывается, что срок его действия уже истек.
* <i>активный </i>путь истекает через несколько ключей каждые 100 миллисекунд.  

Активное истечение разработано, чтобы быть адаптивным. Цикл истечения запускается каждые 100 миллисекунд (10 раз в секунду) и будет выполнять следующие действия:
 * удаление всех ключей с истекшим сроком действия
 * Если более 25% ключей оказались просроченными, повторяет удаление.
 
Процесс проверки зацикливается и мы сначала наблюдаем задержки, потом Redis блокирует опирации записи

<hr>

### Задача 3
Вы подняли базу данных MySQL для использования в гис-системе. При росте количества записей, в таблицах базы, пользователи начали жаловаться на ошибки вида:

```InterfaceError: (InterfaceError) 2013: Lost connection to MySQL server during query u'SELECT..... '```

Как вы думаете, почему это начало происходить и как локализовать проблему?  
Какие пути решения данной проблемы вы можете предложить?


### Ответ:

<i>
Это возникает из-за выборки очень большого объема данных.  
решение - вы можете увеличить лимит запросов, задав переменную max_allowed_packet
</i>

<hr>

### Задача 4
Вы решили перевести гис-систему из задачи 3 на PostgreSQL, так как прочитали в документации, что эта СУБД работает с большим объёмом данных лучше, чем MySQL.

После запуска пользователи начали жаловаться, что СУБД время от времени становится недоступной. В dmesg вы видите, что:

```postmaster invoked oom-killer```

* Как вы думаете, что происходит?

* Как бы вы решили эту проблему?


### Ответ:

<i>
Что происходит:</i> вызов Out of Memory Killer-a -  говторит о том, что приложение съело всю память и приложение было завершено аварийно.  
<i>Решения:</i>

* Очередь сообщений(Пакетная операция batch)
* зарезервировать больше памяти, чем есть, но не выделять ее по факту, а указать процент памяти, для которого допустимо избыточное резервирование. Этим поведением управляет параметр ядра Linux.
* выделить больше памяти для сервера
</i>
<hr>